<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>‚õΩ Gestion du Carburant - UFR SES</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="js/auth.js"></script>
  <script src="js/main.js"></script>
</head>
<body>

  <!-- üîê V√©rification d'authentification -->
  <script>
    const user = checkAuth();
  </script>

  <header>
    <h1>‚õΩ Gestion du Carburant</h1>
    <a href="index.html" class="back">‚Üê Retour au menu</a>
    <a href="login.html" id="logoutBtn" style="font-size: 14px; color: #900;">üîê D√©connexion</a>
  </header>

  <main>
    <!-- Formulaire de ravitaillement -->
    <section class="card" id="formSection">
      <h2>Enregistrer un ravitaillement</h2>
      <form id="formCarburant">
        <label>Date :</label>
        <input type="date" id="datePlein" required />

        <label>V√©hicule :</label>
        <select id="vehicule">
          <option value="Toyota Hilux">Toyota Hilux</option>
          <option value="Peugeot 504">Peugeot 504</option>
          <option value="Fourgonnette">Fourgonnette UASZ</option>
          <option value="Autre">Autre</option>
        </select>

        <label>Conducteur :</label>
        <input type="text" id="conducteur" placeholder="Ex: M. Sarr" required />

        <label>Kilom√©trage actuel (km) :</label>
        <input type="number" id="kilometrage" placeholder="Ex: 45200" required />

        <label>Quantit√© ravitaill√©e (L) :</label>
        <input type="number" id="quantite" step="0.1" placeholder="Ex: 60.5" required />

        <label>Co√ªt total (FCFA) :</label>
        <input type="number" id="cout" placeholder="Ex: 60000" required />

        <button type="submit">Enregistrer le plein</button>
      </form>
    </section>

    <!-- R√©sum√© de la consommation -->
    <section class="card">
      <h2>R√©sum√© de la consommation</h2>
      <p><strong>Nombre de pleins enregistr√©s :</strong> <span id="nbPleins">0</span></p>
      <p><strong>Consommation moyenne globale :</strong> <span id="consoMoyenne">0 L/100km</span></p>
      <p><strong>Dernier ravitaillement :</strong> <span id="dernierPlein">Aucun</span></p>
    </section>

    <!-- Historique des pleins -->
    <section class="card">
      <h2>Historique des ravitaillements</h2>
      <table id="tableauPleins">
        <thead>
          <tr>
            <th>Date</th>
            <th>V√©hicule</th>
            <th>Conducteur</th>
            <th>Km</th>
            <th>Litres</th>
            <th>Co√ªt</th>
            <th>Conso</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="7">Aucun plein enregistr√©.</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- üîí PROTECTION PAR R√îLE -->
  <script>
    // üîë Seul le comptable peut saisir
    const rolesAutorises = ["comptable"];

    if (!rolesAutorises.includes(user.role)) {
      // Masquer le formulaire
      document.getElementById("formSection").style.display = "none";

      // D√©sactiver tous les champs et boutons
      document.querySelectorAll("input, select, button, textarea").forEach(el => {
        el.disabled = true;
        el.style.opacity = "0.6";
      });

      // Bloquer toute soumission (m√™me forc√©e)
      document.querySelectorAll("form").forEach(form => {
        form.addEventListener("submit", function(e) {
          e.preventDefault();
          alert(`‚ùå Action bloqu√©e : seul le comptable peut enregistrer un ravitaillement.`);
        });
      });

      // Ajouter un message visible
      const notice = document.createElement("div");
      notice.textContent = `üìò Mode lecture seule ‚Äì Connect√©(e) en tant que ${user.role}`;
      notice.style = "background: #e8f5e8; color: #2e7d32; padding: 14px; text-align: center; font-weight: bold; margin: 20px 20px; border-radius: 5px; border: 1px solid #a5d6a7;";
      document.querySelector("main").prepend(notice);
    }

    // üîê Confirmation de d√©connexion
    document.getElementById("logoutBtn").addEventListener("click", function(e) {
      if (confirm("Voulez-vous vraiment vous d√©connecter ?")) {
        localStorage.removeItem("user");
      } else {
        e.preventDefault();
      }
    });
  </script>

  <!-- üì• Logique m√©tier -->
  <script src="js/carburant.js"></script>

</body>
</html>
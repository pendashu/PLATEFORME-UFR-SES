<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìã Plan de Passation - UFR SES</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Avant tout contenu -->
<script>
  // V√©rifie si l'utilisateur est connect√©
  if (typeof checkAuth !== 'function') {
    // Charge la fonction si elle n'existe pas encore
    document.write('<script src="js/auth.js"><\/script>');
  }
  const currentUser = checkAuth();
</script>
  <header>
    <h1>üìã Suivi du Plan de Passation des March√©s</h1>
    <a href="index.html" class="back">‚Üê Retour au menu</a>
  </header>

  <main>
    <!-- Formulaire d'ajout -->
    <section class="card">
      <h2>Ajouter une op√©ration de passation</h2>
      <form id="formPassation">
        <label>R√©f√©rence (ex: PP-001) :</label>
        <input type="text" id="ref" placeholder="PP-001" required />

        <label>Objet de l'achat :</label>
        <input type="text" id="objet" placeholder="Ex: Achat de chaises de bureau" required />

        <label>Date du besoin :</label>
        <input type="date" id="dateBesoin" required />

        <label>Budget estim√© (FCFA) :</label>
        <input type="number" id="budgetEstime" placeholder="600000" required />

        <button type="submit">Enregistrer</button>
      </form>
    </section>

    <!-- √âtapes du processus -->
    <section class="card">
      <h2>Suivi des √©tapes</h2>
      <p><em>Cliquez sur une ligne pour mettre √† jour son statut.</em></p>
      <table id="tableauPassation">
        <thead>
          <tr>
            <th>R√©f</th>
            <th>Objet</th>
            <th>Besoin</th>
            <th>Consultation</th>
            <th>Adjudication</th>
            <th>Livraison</th>
            <th>Paiement</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          <!-- Les lignes s'ajoutent ici -->
          <tr><td colspan="8">Aucune op√©ration enregistr√©e.</td></tr>
        </tbody>
      </table>
    </section>

    <!-- D√©tail de mise √† jour -->
    <section class="card" id="sectionDetail" style="display: none;">
      <h2>Mettre √† jour une √©tape</h2>
      <p><strong>Op√©ration :</strong> <span id="detailObjet"></span></p>
      <form id="formMiseAJour">
        <label>√âtape √† mettre √† jour :</label>
        <select id="etape" disabled>
          <option value="consultation">Consultation</option>
          <option value="adjudication">Adjudication</option>
          <option value="livraison">Livraison</option>
          <option value="paiement">Paiement</option>
        </select>

        <label>Date :</label>
        <input type="date" id="dateUpdate" required />

        <label>Observations (facultatif) :</label>
        <textarea id="observation"></textarea>

        <button type="submit">Valider la mise √† jour</button>
        <button type="button" id="annulerUpdate">Annuler</button>
      </form>
    </section>
  </main>

  <!-- Lien vers le script -->
  <script src="js/passation.js"></script>
  <script>
  if (user.role === "csa") {
    // 1Ô∏è‚É£ Masquer les formulaires et boutons
    document.querySelectorAll("form").forEach(f => f.style.display = "none");
    document.querySelectorAll("button[type='submit']").forEach(b => b.style.display = "none");

    // 2Ô∏è‚É£ D√©sactiver tous les champs de saisie (pour s√©curit√©)
    document.querySelectorAll("input, select, textarea").forEach(input => {
      input.disabled = true;
      input.style.backgroundColor = "#f5f5f5";
    });

    // 3Ô∏è‚É£ Bloquer TOUTE soumission de formulaire
    document.querySelectorAll("form").forEach(form => {
      form.addEventListener("submit", function(e) {
        e.preventDefault(); // ‚õî Emp√™che la soumission
        alert("‚ùå Action non autoris√©e : mode lecture seule.");
      });
    });

    // 4Ô∏è‚É£ Message clair
    const notice = document.createElement("div");
    notice.style = "background: #fff3cd; color: #856404; padding: 15px; text-align: center; font-weight: bold; margin-bottom: 20px; border-radius: 5px; border: 1px solid #ffeaa7;";
    notice.textContent = "Mode lecture seule ‚Äì Conseil Scientifique Acad√©mique";
    const header = document.querySelector("header");
    if (header) {
      header.after(notice);
    }
  }
</script>
</body>
</html>
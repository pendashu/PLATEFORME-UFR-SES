<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Gestion des Stocks - UFR SES</title>
  <link rel="stylesheet" href="css/style.css" />
  <!-- Chargement des scripts -->
  <script src="js/auth.js"></script>
</head>
<body>

  <!-- ‚úÖ V√©rification d'authentification -->
  <script>
    const user = checkAuth();
  </script>

  <header>
    <h1>üì¶ Gestion des Stocks</h1>
    <a href="index.html" class="back">‚Üê Retour au menu</a>
    <a href="login.html" id="logoutBtn" style="font-size: 14px; color: #900;">üîê D√©connexion</a>
  </header>

  <main>
    <!-- Section r√©serv√©e au comptable -->
    <section class="card" id="section-saisie">
      <h2>Ajouter une entr√©e ou sortie</h2>
      <form id="formStock">
        <label>Type :</label>
        <select id="typeMouvement">
          <option value="entree">Entr√©e</option>
          <option value="sortie">Sortie</option>
        </select>

        <label>Article :</label>
        <input type="text" id="article" required />

        <label>Quantit√© :</label>
        <input type="number" id="quantite" required />

        <label>Date :</label>
        <input type="date" id="dateMouvement" required />

        <button type="submit">Enregistrer</button>
      </form>
    </section>

    <!-- Tableau des stocks -->
    <section class="card">
      <h2>√âtat des stocks</h2>
      <table id="tableauStocks">
        <thead>
          <tr>
            <th>Article</th>
            <th>Stock actuel</th>
            <th>Seuil</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="4">Aucun article ajout√©.</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- ‚úÖ PROTECTION DES R√îLES -->
  <script>
    // üîí Seul le comptable peut saisir
    const rolesAutorises = ["comptable"];

    if (!rolesAutorises.includes(user.role)) {
      // Masquer le formulaire
      document.getElementById("section-saisie").style.display = "none";

      // D√©sactiver tous les champs
      document.querySelectorAll("input, select, button").forEach(el => {
        el.disabled = true;
      });

      // Bloquer toute soumission
      document.querySelectorAll("form").forEach(form => {
        form.addEventListener("submit", function(e) {
          e.preventDefault();
          alert(`‚ùå Interdit : seul le comptable peut effectuer des saisies.`);
        });
      });

      // Message d'information
      const notice = document.createElement("div");
      notice.textContent = `üëÅÔ∏è Mode lecture seule ‚Äì Connect√©(e) en tant que ${user.role}`;
      notice.style = "background: #e8f5e8; color: #2e7d32; padding: 12px; text-align: center; font-weight: bold; margin: 15px 20px; border-radius: 5px;";
      document.querySelector("main").prepend(notice);
    }
  </script>

  <!-- ‚úÖ Gestion du d√©connexion -->
  <script>
    document.getElementById("logoutBtn").addEventListener("click", function(e) {
      if (confirm("Voulez-vous vraiment vous d√©connecter ?")) {
        localStorage.removeItem("user");
        window.location.href = "login.html";
      }
    });
  </script>

</body>
</html>
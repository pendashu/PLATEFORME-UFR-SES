// Chargement au d√©marrage
document.addEventListener("DOMContentLoaded", function () {
  // Charger les donn√©es sauvegard√©es
  const depenses = JSON.parse(localStorage.getItem("depenses")) || [];
  const budgetTotal = localStorage.getItem("budgetTotal") || 1500000;

  // Mettre √† jour les champs
  document.getElementById("budgetTotal").value = budgetTotal;

  // Afficher les d√©penses
  afficherDepenses(depenses);
  mettreAJourResume();
});

// Ajouter une d√©pense
document.getElementById("formDepense").addEventListener("submit", function (e) {
  e.preventDefault();

  const motif = document.getElementById("motif").value;
  const montant = parseFloat(document.getElementById("montant").value);
  const date = new Date().toLocaleDateString("fr-MA");

  // R√©cup√©rer les anciennes d√©penses
  let depenses = JSON.parse(localStorage.getItem("depenses")) || [];

  // Ajouter la nouvelle
  depenses.push({ motif, montant, date });
  localStorage.setItem("depenses", JSON.stringify(depenses));

  // Mettre √† jour l'affichage
  afficherDepenses(depenses);
  mettreAJourResume();

  // R√©initialiser le formulaire
  this.reset();
});

// Fonction pour afficher la liste des d√©penses
function afficherDepenses(depenses) {
  const liste = document.getElementById("listeDepenses");
  if (depenses.length === 0) {
    liste.innerHTML = "<li>Aucune d√©pense enregistr√©e.</li>";
  } else {
    liste.innerHTML = "";
    depenses.forEach((d, i) => {
      const li = document.createElement("li");
      li.textContent = `${d.date} - ${d.motif} : ${d.montant.toLocaleString()} FCFA`;
      liste.appendChild(li);
    });
  }
}

// Fonction pour mettre √† jour le r√©sum√©
function mettreAJourResume() {
  const depenses = JSON.parse(localStorage.getItem("depenses")) || [];
  const totalDepenses = depenses.reduce((acc, d) => acc + d.montant, 0);
  const budgetTotal = parseFloat(document.getElementById("budgetTotal").value);

  // Sauvegarder le budget modifi√©
  localStorage.setItem("budgetTotal", budgetTotal);

  const solde = budgetTotal - totalDepenses;

  // Afficher les r√©sultats
  document.getElementById("depenses").textContent = totalDepenses.toLocaleString() + " FCFA";
  document.getElementById("solde").textContent = solde.toLocaleString() + " FCFA";

  const statut = document.getElementById("statut");
  if (solde < 0) {
    statut.textContent = "üö® CRITIQUE ‚Äì D√©passement";
    statut.style.color = "red";
  } else if (solde < budgetTotal * 0.2) {
    statut.textContent = "‚ö†Ô∏è Attention ‚Äì Solde faible";
    statut.style.color = "orange";
  } else {
    statut.textContent = "‚úÖ Normal";
    statut.style.color = "green";
  }
}

// Mettre √† jour le r√©sum√© si le budget est modifi√©
document.getElementById("budgetTotal").addEventListener("change", function () {
  localStorage.setItem("budgetTotal", this.value);
  mettreAJourResume();
});